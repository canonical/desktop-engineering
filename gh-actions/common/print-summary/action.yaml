name: Print summary
description: This prints the summary of any given step results in an array.

inputs:
  title:
    description: The title header of the summary section.
    required: true
  step-results:
    description: A new-line separate list of .outcome result of a job, followed by a space and then, the text to print next to the result.
    required: true

runs:
  using: "composite"
  steps:
    - name: Print job summary
      shell: bash --noprofile --norc -euo pipefail {0}
      run: |
        # Print summary both to the job summary page and the logs

        print_status_line () {
          status=$1

          if [ "${status}" == "success" ]; then
            echo "| $2 | ✅ Success |" >> $GITHUB_STEP_SUMMARY
          elif [ "${status}" == "failure" ]; then
            echo "| $2 | ❌ Failure |" >> $GITHUB_STEP_SUMMARY
          elif [ "${status}" == "skipped" ]; then
            echo "| $2 | ⏭️ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| $2 | ❓ Unknown status: ${status} |" >> $GITHUB_STEP_SUMMARY
          fi
        }

        echo '### ${{ inputs.title }}' >> $GITHUB_STEP_SUMMARY

        echo "| Job | Status |" >> $GITHUB_STEP_SUMMARY
        echo "| --- | :---:  |" >> $GITHUB_STEP_SUMMARY

        while IFS= read -r jobResult; do
            # Trim leading and trailing whitespaces
            shopt -s extglob
            jobResult="${jobResult##*( )}"
            jobResult="${jobResult%%*( )}"
            shopt -u extglob

            if [ -z "${jobResult}" ]; then
              continue
            fi

            res=${jobResult%%" "*}
            name=${jobResult#*" "}
            print_status_line "${res}" "${name}"
        done <<< '${{ inputs.step-results }}'

        # Print the summary to the logs
        cat "$GITHUB_STEP_SUMMARY"
